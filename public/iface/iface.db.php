<?php/** * Module DataBase; * Модуль для работы с БД * @author Alexey iP Subbota * @version 0.1 */class iface_db{    public $engine = NULL;    private $conn;    /**     * Инициализация базы     */    public function start()    {        $this->conn = mysql_connect(            $this->engine->config['db']['host'],            $this->engine->config['db']['user'],            $this->engine->config['db']['pass']        );        if (!$this->conn) {            die('Can\'t find db');        }        mysql_select_db($this->engine->config['db']['basename'], $this->conn) or die('Can\'t find database');        mysql_query('set character_set_client=\'utf8\'');        mysql_query('set character_set_results=\'utf8\'');        mysql_query('set collation_connection=\'utf8_general_ci\'');    }    /**     * Выполнение запроса к БД     * @param string query - запрос     * @param string result_type - тип ответа (single - одно значение, row - одна строка, list - массив строк, array - колонка)     * @param string array_row - имя колонки, которую надо забрать, если указан сбор по колонке     * @result mixed     */    public function &query($query, $result_type = 'list', $array_row = 'id')    {        $result = false;        $query_res = mysql_query($query, $this->conn);        if (mysql_errno() > 0) {            $this->engine->vardump($query);            $this->engine->vardump(mysql_error());            return $result;        }        $query_command = mb_substr($query, 0, 6);        if ($query_command === 'SELECT') {            if (mysql_num_rows($query_res) == 0) {                return $result;            }                    switch($result_type) {                case 'single':                    $results = mysql_fetch_assoc($query_res);                    $result = array_shift($results);                    break;                case 'row':                    $result = mysql_fetch_assoc($query_res);                break;                case 'list':                    while ($row = mysql_fetch_assoc($query_res)) {                        $result[] = &$row;                        unset($row);                    }                    break;                case 'array':                    while ($row = mysql_fetch_assoc($query_res)) {                        $result[] = &$row[$array_row];                        unset($row);                    }                    break;                default:            }        } else if ( ($query_command === 'INSERT') || ($query_command === 'UPDATE') ) {            $result = mysql_insert_id();        }        return $result;    }    /**     * сборщик запроса Where     * @param array param - список параметров     * @param array fields - перечень полей     * @result array - массив со строками where и указанием, является возвращаемый элемент один или массив     */    public function &makeWhere($param = array(), $fields = array())    {        $result = array();        return $result;    }    /**     * сборщик запроса Order     * @param array param - список параметров     * @param array orders - перечень полей     * @result array - массив со строками order     */    public function &makeOrder($param = array(), $orders = array())    {        $result = array();        return $result;    }}